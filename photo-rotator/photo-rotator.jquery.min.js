/*
* Photo Rotator Plugin for jQuery
* By: Herman Lee, http://www.scratchinghead.com
* Version: 1.0.0
* Updated: July 27th, 2011
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/
(function(a){a.fn.photoRotator=function(d){d=a.extend({},a.fn.photoRotator.option,d);if(!d.images||d.images.length===0){throw new Error("ImageNotExistException")}var e=b();a('<div id="ph-container"></div>').css({width:"960px",height:"340px",position:"relative"}).appendTo(a(this));a('<div id="ph-loading_box"></div>').css({width:"100%",height:"100%",display:"block",position:"absolute"}).append(a('<img src="'+d.preloadImage+'"></img>').css({display:"block",margin:"150px auto 0"})).appendTo(a("#ph-container"));a('<div id="ph-lightbox-overlay"></div>').css({width:e.pageWidth,height:e.pageHeight,display:"none",position:"absolute",opacity:"0.75","background-color":"#FFF","z-index":"4900",top:"0",left:"0"}).appendTo(a("body"));a('<div id="ph-lightbox"></div>').css({width:e.pageWidth,height:e.pageHeight,display:"none",position:"absolute","text-align":"center","z-index":"5000",top:"0",left:"0"}).appendTo(a("body"));a("#ph-lightbox").click(function(){a("[id|=ph-lightbox]").fadeOut(d.fadeSpeed)});return this.each(function(){var f=a(this).children("#ph-container"),g=d.captionContainer,h=0;a('<div id="image_box"></div>').css({width:"100%",height:"100%",position:"absolute",display:"none"}).appendTo(f);if(!d.captionContainer&&d.captionSwitch){g="pr_caption_box";f.append('<div class="'+g+'"></div>')}a.each(d.images,function(b,e){a("<img />").css(b<7?c["pos"+(b+1)]:c.hide).attr("src",e.url).attr("id","img"+(b+1)).attr("action",e.action||"").attr("href",e.href||"").addClass(b<7?"pos"+(b+1):"hide").load(function(){h++;if(h===d.images.length){a(f).children("#ph-loading_box").fadeOut(d.fadeSpeed);a(f).children("#image_box").fadeIn(d.fadeSpeed)}}).appendTo(a(f).children("#image_box"));if(d.captionSwitch){a("<span></span>").attr("id","cap"+(b+1)).html(e.caption).appendTo(a("."+g))}});var i=f.children("#image_box").find("img").css({border:"5px solid #FFF",position:"absolute",cursor:"pointer","-moz-box-shadow":"5px 5px 10px #333","-webkit-box-shadow":"5px 5px 10px #333","box-shadow":"5px 5px 10px #333","-ms-filter":"\"progid:DXImageTransform.Microsoft.Shadow(Strength=10, Direction=135, Color='#333333')\"",filter:'progid:DXImageTransform.Microsoft.Shadow(Strength=10, Direction=135, Color="#333333")'});if(d.captionSwitch){a("."+g).css("position","relative");a("."+g+" span").css({display:"none",position:"absolute"});if(!d.captionContainer){a("."+g).css({width:"400px",height:"40px",margin:"0 auto"});a("."+g+" span").css({font:"30px/36px helvetica, serif","font-weight":"bold",color:"#000","text-align":"center",width:"400px"})}a("."+g).find("#cap4").show()}var j=function(b){a(i).each(function(){var e=this;var g=a(this).attr("class");var h=b>0?a(this).next().attr("class"):a(this).prev().attr("class");if(!h){h=b>0?f.find("#image_box img:first-child").attr("class"):f.find("#image_box img:last-child").attr("class")}if(g==="hide"&&h==="hide"){return}if(g==="pos4"&&d.captionSwitch){a("#"+a(this).attr("id").replace(/img/,"cap")).fadeOut(d.fadeSpeed)}var i=window.setTimeout(function(){a(e).removeClass(g).addClass(h)},200);a(this).animate(c[h],d.rotateSpeed);if(h==="pos4"&&d.captionSwitch){a("#"+a(this).attr("id").replace(/img/,"cap")).fadeIn(d.fadeSpeed)}})};a(i).each(function(){a(this).click(function(){var c=a(this).attr("class");if(c.replace(/pos/,"")>4){j(1)}else if(c.replace(/pos/,"")<4){j(-1)}else{if(a(this).attr("action")==="link"){if(!a(this).attr("href")){throw new Error("MissingUrlForLinkException")}window.location=a(this).attr("href")}else if(a(this).attr("action")==="fullsize"){a("#ph-lightbox").html("").append(a(this).clone().css({position:"static",height:"auto",margin:"20px"}));a("[id|=ph-lightbox]").fadeIn(d.fadeSpeed);var f=b();if(f.pageWidth>e.pageWidth-80||f.pageHeight>e.pageHeight-60){a("#ph-lightbox img").css({height:e.pageHeight-60+"px"})}}}})});a(document).keydown(function(a){if(a.keyCode===39){j(1);a.preventDefault()}else if(a.keyCode===37){j(-1);a.preventDefault()}})})};a.fn.photoRotator.option={preloadImage:"/images/loading.gif",fadeSpeed:900,rotateSpeed:600,captionSwitch:true,captionContainer:""};var b=function(){var a,b;if(window.innerHeight&&window.scrollMaxY){a=window.innerWidth+window.scrollMaxX;b=window.innerHeight+window.scrollMaxY}else if(document.body.scrollHeight>document.body.offsetHeight){a=document.body.scrollWidth;b=document.body.scrollHeight}else{a=document.body.offsetWidth;b=document.body.offsetHeight}var c,d;if(self.innerHeight){if(document.documentElement.clientWidth){c=document.documentElement.clientWidth}else{c=self.innerWidth}d=self.innerHeight}else if(document.documentElement&&document.documentElement.clientHeight){c=document.documentElement.clientWidth;d=document.documentElement.clientHeight}else if(document.body){c=document.body.clientWidth;d=document.body.clientHeight}if(b<d){pageHeight=d}else{pageHeight=b}if(a<c){pageWidth=a}else{pageWidth=c}return{pageWidth:pageWidth,pageHeight:pageHeight,windowWidth:c,windowHeight:d}};var c={pos1:{left:"205px",top:"130px","z-index":"1",height:"70px",width:"auto",opacity:"0"},pos2:{left:"50px",top:"107px","z-index":"10",height:"115px",width:"auto",opacity:"0.35"},pos3:{left:"100px",top:"45px","z-index":"100",height:"250px",width:"auto",opacity:"0.75"},pos4:{left:"275px",top:"20px",height:"300px",width:"auto","z-index":"200",opacity:"10"},pos5:{left:"516px",top:"45px","z-index":"100",height:"250px",width:"auto",opacity:"0.75"},pos6:{left:"746px",top:"107px","z-index":"10",height:"115px",width:"auto",opacity:"0.35"},pos7:{left:"650px",top:"130px","z-index":"1",height:"70px",width:"auto",opacity:"0"},hide:{left:"400px",top:"130px","z-index":"0",height:"70px",width:"auto",opacity:"0"}}})(jQuery)